# ‚úÖ Credit Sync System - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!

## üéØ ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### ‚ùå **‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏î‡∏¥‡∏°**
- ‡πÉ‡∏ä‡πâ‡∏ï‡∏≤‡∏£‡∏≤‡∏á `credit_balance` ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
- ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ upsert ‡πÅ‡∏•‡∏∞ unique constraint
- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ 2 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á

### ‚úÖ **‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡∏°‡πà**
- ‡πÉ‡∏ä‡πâ `user_profiles` table ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
- ‡∏°‡∏µ field `credit_balance` ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Edge Function ‡πÅ‡∏•‡∏∞ Frontend Services

## üîß **‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç**

### 1. **Edge Function (`sync-credit/index.ts`)**
```typescript
// ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å credit_balance table ‡πÄ‡∏õ‡πá‡∏ô user_profiles
await supabaseClient
  .from('user_profiles')
  .update({
    credit_balance: creditData.balance,
    updated_at: new Date().toISOString()
  })
  .eq('id', userId)
```

### 2. **CreditSyncService.ts**
```typescript
// ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å user_profiles ‡πÅ‡∏ó‡∏ô
const { data } = await supabase
  .from('user_profiles')
  .select('id, credit_balance, updated_at')
  .eq('id', targetUserId)
  .single()
```

### 3. **Realtime Subscription**
```typescript
// ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° user_profiles table ‡πÅ‡∏ó‡∏ô
.on('postgres_changes', {
  event: 'UPDATE',
  schema: 'public',
  table: 'user_profiles',
  filter: `id=eq.${targetUserId}`
})
```

## üöÄ **Status**

- ‚úÖ **Edge Function** - Deploy ‡πÅ‡∏•‡πâ‡∏ß
- ‚úÖ **Frontend Services** - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏™‡∏£‡πá‡∏à  
- ‚úÖ **Component** - ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß
- üóëÔ∏è **credit_balance table** - ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á

## üì± **‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö**

1. **‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö**
2. **‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ Profile** 
3. **‡∏î‡∏π‡∏¢‡∏≠‡∏î‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á**
4. **‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï"** ‡πÄ‡∏û‡∏∑‡πà‡∏≠ sync ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà

## üéØ **‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á**

- ‚úÖ ‡∏¢‡∏≠‡∏î‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≤‡∏Å `user_profiles.credit_balance`
- ‚úÖ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å SMSUP API
- ‚úÖ API ‡∏à‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î 9713.0 ‡∏ö‡∏≤‡∏ó
- ‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏ô `user_profiles` table
- ‚úÖ UI ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ö‡∏ö real-time

## üìä **Database Schema ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ**

```sql
-- ‡πÉ‡∏ä‡πâ table ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
user_profiles {
  id: uuid (PK)
  credit_balance: numeric (default 100.00)
  updated_at: timestamp
  ...
}
```

‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏•‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡∏π‡πÅ‡∏•‡∏∞‡∏ö‡∏≠‡∏Å‡∏ú‡∏•‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á‡∏Ñ‡∏£‡∏±‡∏ö üéâ